<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="icon" href="Projectile_Icon.png">
	<title>Projectile Motion</title>
	<style>
		body{background-color: skyblue;}
		input{
			border: solid 2px darkblue;
			background-color: whitesmoke;
		}
		#ball{
			position: absolute;
			top: 380px;
			left: 0px;
			width: 20px;
			height: 20px;
			border-radius: 100%;
			background-color: grey;
		}
		#ground{
			position: absolute;
			top: 400px;
			height: 2px;
			width: 100%;
			background-color: black;
		}
		.pixels{
			width: 2px;
			height: 2px;
			pading: 0px 0px 0px 0px;
			margin: 0px 0px 0px 0px;
			float: bottom;
			position: absolute;
			border: 0px;
		}

		#info{
			width: 19%;
			height: 350px;
			background-color: rgb(225,225,255);
			position: absolute;
			left: 78%;
			top: 5px;
			border: ridge 6px black;
			text-align: center;
			padding: 5px;
			overflow: scroll;
		}
		#terminal{
			color: black;
			position: absolute;
			top: 410px;
			font-size: 20px;
		}
		#current{
			color: black;
			position: absolute;
			top: 440px;
			font-size: 20px;	
		}
	</style>
</head>
<body>
	<p id="ball"></p>
	<p id="ground"></p>
	<input id="speed" value = "100" placeholder="Speed (m/s)">
	<input id="angle" value = "1" placeholder="Angle (radians)">
	<input id="b" placeholder="Air Resistance (0-0.02)">
	<input id="g" value="-9.81" placeholder="Gravity (negative)">
	<input id="mass" placeholder="Mass (kg)">
	<button id="start" onclick="start()">Start</button>
	<button id="tracer" onclick="tracer()">Don't Trace</button>
	<p id="terminal"><strong>Terminal Velocity: </strong></p>
	<p id="current"><strong>Current Velocity: </strong></p>


	<p id="info">
		<em>Simulation Parameters: Time mimics reality, 1 pixel = 1 meter (this is important! The ball may appear to fall slowly at times, but it is traveling a large distance per second to the simulation)</em><br><br>
		This is a projectile simulator! Simply input a speed, angle, air resistance coefficient, mass, and gravitational acceleration and press start to run the simulation! The velocity elements refer specifically to the object's vertical velocity.<br><br>
		The air resistance depends on numerous factors, including the cross-sectional area of the body, the air density, the drag coefficient, and an extra 0.5 coefficient. For simplicity, these parameters were reduced to the single value being inputted. Something interesting to note is that the force of air resistance is proportional to the square of velocity! <br><br>
		The solution to the differential equation <br> -y'*|y'|*b=m*y'' <br> where m is mass and y is the horizontal position as a function of time <br> (this comes from air resistance force = -|v|/v*b*v² = -|v|*v*b, where the -|v|/v ensures the force is the opposite sign of the velocity, or in the opposite direction as the movement) <br> (The m*y'' comes from f=m*a, and acceleration is the derivative of velocity and 2nd derivative of position). <br> The solution is <br> xpos(t)=x0+m*ln((b*v0*t/m)+1)/b <br> where v0 and x0 are initial horizontal velocity and speed.<br><br>
		Terminal Velocity is reached when air resistance and gravitational force are equal and cancel each other out. This can be represented as b*v²=m*|g|, which becomes v=sqrt(m|g|/b). At this velocity, the two forces equal and the total force and thus acceleration becomes 0.<br><br>
	</p>
<script type="text/javascript">
	let origin = [0,400];
	let ball = {
		pos: [0,20],
		mass: 5,
		vel: [0,0]
	}
	let angle = 0.5;
	let speed = 300;
	let initialVelocity = [Math.cos(angle)*speed, Math.sin(angle)*speed];
	let g = -9.81
	let time = 0;
	let airResistance = [0,0];
	let force = [0,0];
	let b=0.01;
	let ballEl = document.getElementById("ball");
	ball.vel = [speed*Math.cos(angle), speed*Math.sin(angle)];

	let running;
	let trace = true;

	function graph(x, y, left, height, color = "black") {
	let tmp = document.createElement("p");
	tmp.style.backgroundColor = color;
	tmp.className = "pixels"
	tmp.style.top = height-y+"px";
	tmp.style.left = x+left+"px";
	document.body.appendChild(tmp);}

	function run() {
		time+=1/100;

		ball.pos[0]+=ball.vel[0]/100;
		//ball.pos[0]=ball.mass*Math.log(b*(Math.cos(angle)*speed)*time/ball.mas+1)/b; //Works the exact same
		ball.pos[1]+=ball.vel[1]/100;

		//Air resistance is -|v|/v * 0.5cpA * v^2
			//c=drag coeff, p=air density, A=cross section area, so the middle term is collapsed to b
			//-|v|/v is the math way of saying "In the opposite direction of v"
			//The first and third terms can be collapsed into -|v|*v
			//Our final differential equation is -y'*|y'|*b=y'', which is simplified to -y*|y|*b=y'
			//y is the horizontal velocity as a function of time

		//Using calculus, we get y=1/(bt+c), where c is a constant
			//If c is set to 1/(sin(angle)*speed) (in other words, 1/v0), we get the velocity at a time
			//The math is matching!
			//The integral of 1/(bt+1/v0) dt will give xpos over time 
			//The solution is ln(b*v0*t+1)/b, which returns the x position for time t, air resistance b, and initial velocity v0


		airResistance = [-Math.abs(ball.vel[0])*b*ball.vel[0], -Math.abs(ball.vel[1])*b*ball.vel[1]];
		force = [airResistance[0],ball.mass*g+airResistance[1]]
		ball.vel[1]+=force[1]/100/ball.mass;
		ball.vel[0]+=force[0]/100/ball.mass;

		document.getElementById("current").textContent = "Current Velocity: "+Math.round(100*ball.vel[1])/100+"m/s";

		//graph(ball.mass*Math.log(b/ball.mass*initialVelocity[0]*time+1)/b,0,0,origin[1]);

		//graph(ball.pos[0], ball.vel[0], 0, 1000);
		//graph(ball.pos[0], 1/(b*time+1/initialVelocity[0]), 0, 1000);

		ballEl.style.left = origin[0]+ball.pos[0]+"px";
		ballEl.style.top = origin[1]-ball.pos[1]+"px";

		if (trace) {graph(ball.pos[0], ball.pos[1]-20, ...origin);}
	}
	
	function start() {
		angle = Number(document.getElementById("angle").value);
		speed = Number(document.getElementById("speed").value);
		b = Number(document.getElementById("b").value);
		g = Number(document.getElementById("g").value);
		ball.pos=[0,20];
		ball.mass=document.getElementById("mass").value;
		document.getElementById("terminal").textContent = "Terminal Velocity: "+Math.abs(g)/g*Math.round(100*Math.sqrt(ball.mass*Math.abs(g)/b))/100+"m/s";
		ball.vel=[speed*Math.cos(angle), speed*Math.sin(angle)];
		initialVelocity = [speed*Math.cos(angle), speed*Math.sin(angle)];
		time = 0;
		running = setInterval(run,10);
	}

	function tracer() {
		trace = trace?false:true;
		document.getElementById("tracer").textContent = !trace?"Trace":"Don't Trace";
	}
</script>
</body>
</html>